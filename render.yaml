services:
  # Backend - Docker deployment with all C++ dependencies
  - type: web
    name: codesage-backend
    runtime: docker
    region: oregon
    plan: starter
    dockerfilePath: ./Dockerfile
    dockerContext: ./backend
    envVars:
      - key: GROQ_API_KEY
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: PYTHON_VERSION
        value: "3.11"
      - key: PORT
        value: "10000"
    healthCheckPath: /health
    autoDeploy: true
    disk:
      name: interview-data
      mountPath: /app/interview_results
      sizeGB: 1

  # Frontend - Docker deployment for consistency
  - type: web
    name: codesage-frontend
    runtime: docker
    region: oregon
    plan: starter
    dockerfilePath: ./Dockerfile
    dockerContext: ./frontend
    envVars:
      - key: NEXT_PUBLIC_API_URL
        value: https://codesage-backend.onrender.com
      - key: NEXT_PUBLIC_WS_URL
        value: wss://codesage-backend.onrender.com/ws
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "3000"
    autoDeploy: true
